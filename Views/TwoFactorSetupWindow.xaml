<Window x:Class="WeighbridgeSoftwareYashCotex.Views.TwoFactorSetupWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ðŸ” Two-Factor Authentication Setup" 
        Height="600" Width="800"
        WindowStartupLocation="CenterScreen"
        Background="#f8f9fa" ResizeMode="NoResize">

    <Window.Resources>
        <Style x:Key="HeaderStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Foreground" Value="#2c3e50"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        
        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>
        
        <Style x:Key="PrimaryButton" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="#007bff"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        
        <Style x:Key="SuccessButton" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="#28a745"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        
        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="#dc3545"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        
        <Style x:Key="InfoPanel" TargetType="Border">
            <Setter Property="Background" Value="#e3f2fd"/>
            <Setter Property="BorderBrush" Value="#2196f3"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="5"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,10"/>
        </Style>
    </Window.Resources>

    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#343a40" CornerRadius="8" Padding="20" Margin="0,0,0,20">
            <StackPanel>
                <TextBlock Text="ðŸ” TWO-FACTOR AUTHENTICATION SETUP" 
                           FontSize="18" FontWeight="Bold" 
                           Foreground="White" HorizontalAlignment="Center"/>
                <TextBlock Text="Enhanced security for Super Admin access" 
                           FontSize="12" Foreground="#adb5bd" 
                           HorizontalAlignment="Center" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <TabControl Grid.Row="1" Background="White" BorderThickness="1" BorderBrush="#dee2e6">
            
            <!-- Method Selection Tab -->
            <TabItem Header="ðŸ”— Choose Method">
                <ScrollViewer Padding="20" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Select Two-Factor Authentication Method" Style="{StaticResource HeaderStyle}"/>
                        
                        <Border Style="{StaticResource InfoPanel}">
                            <TextBlock Text="â„¹ï¸ Two-factor authentication adds an extra layer of security to your Super Admin account. Choose the method that works best for you." 
                                       TextWrapping="Wrap" Foreground="#1976d2"/>
                        </Border>

                        <!-- TOTP Method -->
                        <GroupBox Header="ðŸ“± Authenticator App (Recommended)" Margin="0,20,0,15">
                            <StackPanel Margin="15">
                                <TextBlock Text="Use Google Authenticator, Microsoft Authenticator, or similar apps" 
                                           TextWrapping="Wrap" Margin="0,0,0,10"/>
                                <TextBlock Text="âœ“ Works offline" Foreground="#28a745" FontWeight="Bold"/>
                                <TextBlock Text="âœ“ Most secure method" Foreground="#28a745" FontWeight="Bold"/>
                                <TextBlock Text="âœ“ Industry standard" Foreground="#28a745" FontWeight="Bold"/>
                                <Button x:Name="SelectTOTPButton" Content="ðŸ“± Set up Authenticator App" 
                                        Style="{StaticResource PrimaryButton}" 
                                        Click="SelectTOTPButton_Click" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Email Method -->
                        <GroupBox Header="ðŸ“§ Email Verification" Margin="0,0,0,15">
                            <StackPanel Margin="15">
                                <TextBlock Text="Receive verification codes via email" 
                                           TextWrapping="Wrap" Margin="0,0,0,10"/>
                                <TextBlock Text="âš ï¸ Requires internet connection" Foreground="#ffc107" FontWeight="Bold"/>
                                <TextBox x:Name="EmailAddressTextBox" Padding="8" Margin="0,10,0,0" 
                                         Watermark="Enter email address"/>
                                <Button x:Name="SelectEmailButton" Content="ðŸ“§ Set up Email 2FA" 
                                        Style="{StaticResource PrimaryButton}" 
                                        Click="SelectEmailButton_Click" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- SMS Method -->
                        <GroupBox Header="ðŸ“± SMS Verification" Margin="0,0,0,15">
                            <StackPanel Margin="15">
                                <TextBlock Text="Receive verification codes via SMS" 
                                           TextWrapping="Wrap" Margin="0,0,0,10"/>
                                <TextBlock Text="âš ï¸ Requires phone network" Foreground="#ffc107" FontWeight="Bold"/>
                                <TextBox x:Name="PhoneNumberTextBox" Padding="8" Margin="0,10,0,0" 
                                         Watermark="Enter phone number (+1234567890)"/>
                                <Button x:Name="SelectSMSButton" Content="ðŸ“± Set up SMS 2FA" 
                                        Style="{StaticResource PrimaryButton}" 
                                        Click="SelectSMSButton_Click" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- TOTP Setup Tab -->
            <TabItem x:Name="TOTPSetupTab" Header="ðŸ“± Authenticator Setup" Visibility="Collapsed">
                <ScrollViewer Padding="20" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Set up Authenticator App" Style="{StaticResource HeaderStyle}"/>
                        
                        <Border Style="{StaticResource InfoPanel}">
                            <StackPanel>
                                <TextBlock Text="ðŸ“± Follow these steps to configure your authenticator app:" 
                                           FontWeight="Bold" Foreground="#1976d2"/>
                                <TextBlock Text="1. Install Google Authenticator or Microsoft Authenticator" 
                                           Margin="0,5,0,0"/>
                                <TextBlock Text="2. Scan the QR code below OR enter the secret key manually" 
                                           Margin="0,2,0,0"/>
                                <TextBlock Text="3. Enter the 6-digit code from your app to verify setup" 
                                           Margin="0,2,0,0"/>
                            </StackPanel>
                        </Border>

                        <Grid Margin="0,20,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- QR Code Section -->
                            <StackPanel Grid.Column="0" Margin="0,0,30,0">
                                <TextBlock Text="QR Code:" FontWeight="Bold" Margin="0,0,0,10"/>
                                <Border Background="White" BorderBrush="#ccc" BorderThickness="2" 
                                        Width="200" Height="200" HorizontalAlignment="Center">
                                    <TextBlock x:Name="QRCodePlaceholder" Text="ðŸ“± QR Code\nWould appear here\n\n(Use secret key below\nfor manual setup)" 
                                               TextAlignment="Center" VerticalAlignment="Center" 
                                               Foreground="#666" FontSize="12"/>
                                </Border>
                            </StackPanel>
                            
                            <!-- Manual Setup Section -->
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Manual Setup:" FontWeight="Bold" Margin="0,0,0,10"/>
                                <TextBlock Text="Secret Key:" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBox x:Name="SecretKeyTextBox" IsReadOnly="True" 
                                         Background="#f8f9fa" Padding="10" FontFamily="Consolas"
                                         Text="" Margin="0,0,0,10"/>
                                <Button Content="ðŸ“‹ Copy Secret Key" Style="{StaticResource PrimaryButton}" 
                                        Click="CopySecretButton_Click" HorizontalAlignment="Left"/>
                                
                                <TextBlock Text="Verification:" FontWeight="Bold" Margin="0,20,0,10"/>
                                <TextBlock Text="Enter 6-digit code from your authenticator app:"/>
                                <TextBox x:Name="VerificationCodeTextBox" Padding="8" MaxLength="6" 
                                         Margin="0,5,0,10" Width="150" HorizontalAlignment="Left"
                                         FontFamily="Consolas" FontSize="16"/>
                                <Button x:Name="VerifyTOTPButton" Content="âœ… Verify & Enable 2FA" 
                                        Style="{StaticResource SuccessButton}" 
                                        Click="VerifyTOTPButton_Click" HorizontalAlignment="Left"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Backup Codes Tab -->
            <TabItem x:Name="BackupCodesTab" Header="ðŸ”‘ Backup Codes" Visibility="Collapsed">
                <ScrollViewer Padding="20" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Backup Recovery Codes" Style="{StaticResource HeaderStyle}"/>
                        
                        <Border Background="#fff3cd" BorderBrush="#ffc107" BorderThickness="1" 
                                CornerRadius="5" Padding="15" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="âš ï¸ IMPORTANT: Save these backup codes in a secure location!" 
                                           FontWeight="Bold" Foreground="#856404"/>
                                <TextBlock Text="â€¢ Each code can only be used once" Margin="0,5,0,0"/>
                                <TextBlock Text="â€¢ Use these codes if you lose access to your primary 2FA method"/>
                                <TextBlock Text="â€¢ Generate new codes if you suspect they are compromised"/>
                            </StackPanel>
                        </Border>

                        <TextBlock Text="Your Backup Codes:" FontWeight="Bold" Margin="0,0,0,10"/>
                        <Border Background="#f8f9fa" BorderBrush="#dee2e6" BorderThickness="1" 
                                CornerRadius="5" Padding="15">
                            <StackPanel x:Name="BackupCodesPanel">
                                <!-- Backup codes will be populated here -->
                            </StackPanel>
                        </Border>

                        <StackPanel Orientation="Horizontal" Margin="0,20,0,0">
                            <Button Content="ðŸ“‹ Copy All Codes" Style="{StaticResource PrimaryButton}" 
                                    Click="CopyBackupCodesButton_Click"/>
                            <Button Content="ðŸ”„ Generate New Codes" Style="{StaticResource ButtonStyle}" 
                                    Background="#ffc107" Foreground="#212529"
                                    Click="GenerateNewCodesButton_Click"/>
                            <Button Content="ðŸ“„ Print Codes" Style="{StaticResource ButtonStyle}" 
                                    Background="#6c757d" Foreground="White"
                                    Click="PrintCodesButton_Click"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>

        <!-- Footer -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <TextBlock x:Name="StatusText" Text="Select a 2FA method to begin setup" 
                       VerticalAlignment="Center" Margin="0,0,20,0" 
                       FontWeight="Bold" Foreground="#6c757d"/>
            <Button Content="âŒ Cancel" Style="{StaticResource ButtonStyle}" 
                    Background="#6c757d" Foreground="White" 
                    Click="CancelButton_Click"/>
            <Button x:Name="FinishButton" Content="âœ… Finish Setup" 
                    Style="{StaticResource SuccessButton}" 
                    IsEnabled="False" Click="FinishButton_Click"/>
        </StackPanel>
    </Grid>
</Window>